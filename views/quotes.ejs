<%- include('partials/header', { title: 'Request a Quote' }) %>

  <main class="container">
    <!-- Step 1: Pick Your Package -->
    <section id="step-1-package">
      <h2>Step 1: Pick Your Package</h2>
      <div class="package-cards grid">

        <article class="card package-card" data-service="Drops Only">
          <h3>Drops Only</h3>
          <p class="package-price">Starting at $100 per drop</p>
          <ul class="package-features">
            <li>Cable drops ran and terminated</li>
            <li>Cat6 for internet or phone</li>
            <li>Coax cable runs</li>
            <li>Fiber optic runs</li>
            <li>Low-voltage box, plate, keystone included</li>
            <li>Testing and verification</li>
          </ul>
          <p class="package-note">Add-ons: AP mounting, ethernet relocation, centralization options</p>
          <button type="button" class="service-select-btn" data-service="Drops Only">Select Drops Only</button>
        </article>

        <article class="card package-card" data-service="Whole-Home">
          <h3>Whole-Home Setup</h3>
          <p class="package-price">Deposit-based, quoted on-site</p>
          <ul class="package-features">
            <li>Drops + full network installation</li>
            <li>Security camera systems</li>
            <li>VoIP phone systems</li>
            <li>Includes site survey</li>
            <li>Professional equipment recommendations</li>
          </ul>
          <p class="package-note">Final pricing determined after site survey</p>
          <button type="button" class="service-select-btn" data-service="Whole-Home">Select Whole-Home</button>
        </article>

      </div>
    </section>

    <!-- Step 2: Service Details -->
    <section id="step-2-details" style="display: none;">
      <h2>Step 2: Service Details</h2>

      <div id="selectedServiceDisplay">
        <strong>Selected: <span id="serviceDisplayName"></span></strong>
        <button type="button" id="changeServiceBtn">Change</button>
      </div>

      <!-- Drops Only Details -->
      <div id="drops-only-details" style="display: none;">
        <fieldset>
          <legend>Cable Runs</legend>

          <div class="cable-run-row">
            <label for="cat6Runs">
              Cat6 runs - $100/run:
              <input type="number" id="cat6Runs" name="cat6Runs" min="0" value="0" />
            </label>
            <button type="button" class="info-btn" data-cable="cat6" aria-label="Cat6 info"><i class="fas fa-info-circle"></i></button>
          </div>
          <div class="cable-info" id="cat6-info">
            <strong>CAT6 550MHz UTP</strong> &mdash; typically used for ethernet, can also be used for landline phones. Cat6a available upon request at additional cost.
          </div>

          <div class="cable-run-row">
            <label for="coaxRuns">
              Coax runs - $150/run:
              <input type="number" id="coaxRuns" name="coaxRuns" min="0" value="0" />
            </label>
            <button type="button" class="info-btn" data-cable="coax" aria-label="Coax info"><i class="fas fa-info-circle"></i></button>
          </div>
          <div class="cable-info" id="coax-info">
            <strong>RG-6 Coaxial</strong> &mdash; used for transmitting video signals and by legacy internet providers.
          </div>

          <div class="cable-run-row">
            <label for="fiberRuns">
              Fiber runs - $200/run:
              <input type="number" id="fiberRuns" name="fiberRuns" min="0" value="0" />
            </label>
            <button type="button" class="info-btn" data-cable="fiber" aria-label="Fiber info"><i class="fas fa-info-circle"></i></button>
          </div>
          <div class="cable-info" id="fiber-info">
            <strong>OS2 Single-Mode Fiber</strong> &mdash; terminated to match your use case. Ideal for relocating fiber ONTs, high-speed connections over long distances, and future-proofing your infrastructure.
          </div>
        </fieldset>

        <fieldset>
          <legend>Drop Centralization</legend>
          <p>Where should your drops be centralized?</p>

          <label class="radio-label" for="centralizationMediaPanel">
            <input type="radio" id="centralizationMediaPanel" name="centralization" value="Media Panel" /> Media Panel
          </label>
          <label class="radio-label" for="centralizationPatchPanel">
            <input type="radio" id="centralizationPatchPanel" name="centralization" value="Patch Panel" /> Patch Panel (+$50)
          </label>
          <label class="radio-label" for="centralizationLoose">
            <input type="radio" id="centralizationLoose" name="centralization" value="Loose Termination" /> Loose Termination (Free)
          </label>

          <div id="mediaPanelInlineQuestion" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--surface-light); border-radius: var(--radius); border-left: 3px solid var(--accent);">
            <p><strong>Do you have an existing media panel?</strong></p>
            <label class="radio-label" for="inlineHasPanelYes">
              <input type="radio" id="inlineHasPanelYes" name="inlineHasMediaPanel" value="yes" /> Yes ($0)
            </label>
            <label class="radio-label" for="inlineHasPanelNo">
              <input type="radio" id="inlineHasPanelNo" name="inlineHasMediaPanel" value="no" checked /> No (+$100 install)
            </label>
          </div>
        </fieldset>

        <fieldset>
          <legend>Add-on Services</legend>

          <label for="apMountQty">
            AP mounting ($25/each):
            <input type="number" id="apMountQty" name="apMountQty" min="0" value="0" />
          </label>

          <label for="ethRelocationQty">
            Ethernet relocation ($20/drop):
            <input type="number" id="ethRelocationQty" name="ethRelocationQty" min="0" value="0" />
          </label>
        </fieldset>

        <fieldset id="pricingSection">
          <legend>Estimated Pricing</legend>
          <p><strong>Total Cost: $<span id="totalCost">0</span></strong></p>
          <p>Deposit Required: $<span id="depositAmount">0</span></p>
          <p><em>Final pricing may vary based on site conditions.</em></p>
        </fieldset>
      </div>

      <!-- Whole-Home Details -->
      <div id="whole-home-details" style="display: none;">
        <fieldset>
          <legend>Scope of Work</legend>
          <p>Select all that apply (at least one required):</p>

          <label class="checkbox-label" for="scopeNetworking">
            <input type="checkbox" id="scopeNetworking" name="scopeNetworking" /> Networking
          </label>

          <label class="checkbox-label" for="scopeSecurity">
            <input type="checkbox" id="scopeSecurity" name="scopeSecurity" /> Security
          </label>

          <label class="checkbox-label" for="scopeVoip">
            <input type="checkbox" id="scopeVoip" name="scopeVoip" /> VoIP
          </label>
        </fieldset>

        <fieldset>
          <legend>Internet & Equipment</legend>

          <label for="internetSpeed">
            Internet speed (e.g., "500 Mbps", "1 Gig"):
            <input type="text" id="internetSpeed" name="internetSpeed" placeholder="e.g., 1 Gig" maxlength="50" />
          </label>

          <div class="equipment-toggle">
            <p><strong>Do you have your own equipment picked out?</strong></p>
            <label class="radio-label" for="ownEquipmentYes">
              <input type="radio" id="ownEquipmentYes" name="ownEquipment" value="yes" /> Yes
            </label>
            <label class="radio-label" for="ownEquipmentNo">
              <input type="radio" id="ownEquipmentNo" name="ownEquipment" value="no" checked /> No
            </label>
          </div>

          <div id="equipmentDescriptionSection" style="display: none;">
            <label for="equipmentDescription">
              Describe your equipment:
              <textarea id="equipmentDescription" name="equipmentDescription" maxlength="2000"
                        placeholder="List your equipment (brand, model, quantity)..." rows="4"></textarea>
            </label>
          </div>

          <div id="brandPreferencesSection">
            <div class="brand-group">
              <p><strong>Networking brand preference:</strong></p>
              <label class="radio-label"><input type="radio" name="networkingBrand" value="Omada" /> Omada</label>
              <label class="radio-label"><input type="radio" name="networkingBrand" value="UniFi" /> UniFi</label>
              <label class="radio-label"><input type="radio" name="networkingBrand" value="Ruckus" /> Ruckus</label>
              <label class="radio-label"><input type="radio" name="networkingBrand" value="No Preference" checked /> No Preference</label>
            </div>

            <div class="brand-group">
              <p><strong>Security brand preference:</strong></p>
              <label class="radio-label"><input type="radio" name="securityBrand" value="UniFi" /> UniFi</label>
              <label class="radio-label"><input type="radio" name="securityBrand" value="Reolink" /> Reolink</label>
              <label class="radio-label"><input type="radio" name="securityBrand" value="No Preference" checked /> No Preference</label>
            </div>
          </div>
        </fieldset>

        <fieldset>
          <legend>Site Survey Preference</legend>
          <label class="radio-label">
            <input type="radio" name="surveyPreference" value="before-install" checked /> Schedule before install
          </label>
          <label class="radio-label">
            <input type="radio" name="surveyPreference" value="day-of" /> Day of install
          </label>
        </fieldset>

        <fieldset>
          <legend>Additional Notes</legend>
          <label for="wholeHomeNotes">
            <textarea id="wholeHomeNotes" name="wholeHomeNotes" maxlength="2000"
                      placeholder="Anything else we should know about your project..." rows="4"></textarea>
          </label>
        </fieldset>

        <fieldset id="wholeHomePricingSection">
          <legend>Pricing</legend>
          <p><strong>Deposit: $200</strong></p>
          <p><em>Final pricing will be determined after your site survey. The deposit is applied toward your total cost.</em></p>
        </fieldset>
      </div>

      <div class="step-nav">
        <button type="button" id="to-step-3">Next: Home Info</button>
      </div>
    </section>

    <!-- Step 3: Tell Us About Your Home -->
    <section id="step-3-home-info" style="display: none;">
      <h2>Step 3: Tell Us About Your Home</h2>

      <fieldset>
        <legend>Home Details</legend>

        <label for="homeAge">
          Home age:
          <select id="homeAge" name="homeAge" required>
            <option value="">Select...</option>
            <option value="Pre-1960">Pre-1960</option>
            <option value="1960-1980">1960-1980</option>
            <option value="1980-2000">1980-2000</option>
            <option value="2000-2020">2000-2020</option>
            <option value="2020+">2020+</option>
          </select>
        </label>

        <label for="stories">
          Number of stories:
          <select id="stories" name="stories" required>
            <option value="">Select...</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3+</option>
          </select>
        </label>

        <label for="atticAccess">
          Attic access:
          <select id="atticAccess" name="atticAccess" required>
            <option value="">Select...</option>
            <option value="Walk-in attic">Walk-in attic</option>
            <option value="Crawl space">Crawl space</option>
            <option value="Scuttle hole">Scuttle hole</option>
            <option value="No attic access">No attic access</option>
          </select>
        </label>
      </fieldset>

      <fieldset>
        <legend>Access & Infrastructure</legend>

        <div class="toggle-group">
          <p><strong>Existing media panel?</strong></p>
          <label class="radio-label" for="hasMediaPanelYes">
            <input type="radio" id="hasMediaPanelYes" name="hasMediaPanel" value="yes" /> Yes
          </label>
          <label class="radio-label" for="hasMediaPanelNo">
            <input type="radio" id="hasMediaPanelNo" name="hasMediaPanel" value="no" checked /> No
          </label>

          <label for="mediaPanelLocation" id="mediaPanelLocationLabel" style="display: none;">
            Location:
            <input type="text" id="mediaPanelLocation" name="mediaPanelLocation" placeholder="e.g., Garage, Basement, Utility closet" maxlength="100" />
          </label>
        </div>

        <div class="toggle-group">
          <p><strong>Crawl space or basement access?</strong></p>
          <label class="radio-label" for="hasCrawlspaceYes">
            <input type="radio" id="hasCrawlspaceYes" name="hasCrawlspace" value="yes" /> Yes
          </label>
          <label class="radio-label" for="hasCrawlspaceNo">
            <input type="radio" id="hasCrawlspaceNo" name="hasCrawlspace" value="no" checked /> No
          </label>
        </div>
      </fieldset>

      <fieldset class="liability-fieldset">
        <legend>Safety & Liability Acknowledgment</legend>
        <div class="liability-text">
          <p>By checking this box, you acknowledge and understand that:</p>
          <ul>
            <li>Work may involve cutting drywall, drilling through walls/floors/ceilings, and working in attic spaces</li>
            <li>You are responsible for any pre-existing conditions (e.g., old wiring, asbestos concerns in older homes)</li>
            <li>Reasonable care will be taken, but minor cosmetic imperfections near work areas are possible</li>
            <li>Any concerns about hazardous materials should be addressed before work begins</li>
          </ul>
        </div>
        <label class="checkbox-label liability-checkbox" for="liabilityAcknowledged">
          <input type="checkbox" id="liabilityAcknowledged" name="liabilityAcknowledged" required />
          I acknowledge and accept the above
        </label>
      </fieldset>

      <div class="step-nav">
        <button type="button" id="back-to-step-2">Back</button>
        <button type="button" id="to-step-4">Next: Review & Submit</button>
      </div>
    </section>

    <!-- Step 4: Contact Info & Summary -->
    <section id="step-4-contact" style="display: none;">
      <h2>Step 4: Contact Information & Final Quote</h2>

      <!-- Final Quote Summary -->
      <div id="finalQuoteSummary">
        <h3>Quote Summary</h3>
        <div id="summaryContent">
          <!-- Populated by JavaScript -->
        </div>
      </div>

      <!-- Quote Request Form -->
      <form id="quoteForm">
        <!-- Honeypot field -->
        <input type="text" name="honeypot" style="display:none !important;" tabindex="-1" autocomplete="off" />

        <fieldset>
          <legend>Contact Information</legend>
          <label for="name">Name *</label>
          <input id="name" name="name" required maxlength="100" />

          <label for="email">Email *</label>
          <input id="email" name="email" type="email" required maxlength="254" />

          <label for="phone">Phone (optional)</label>
          <input id="phone" name="phone" type="tel" maxlength="20" />
        </fieldset>

        <!-- Hidden inputs -->
        <input type="hidden" id="selectedServiceType" name="serviceType" required />

        <div class="step-nav">
          <button type="button" id="back-to-step-3">Back</button>
          <button type="submit" id="submitBtn">Submit Quote Request</button>
        </div>
      </form>
      <p id="quoteStatus"></p>
    </section>

  </main>

  <style>
    .hidden { display: none; }

    /* Package Cards */
    .package-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin: 2rem 0;
    }

    .package-card {
      background: var(--surface);
      border: 2px solid transparent;
      border-radius: var(--radius);
      padding: 2rem;
      transition: var(--transition);
      cursor: pointer;
    }

    .package-card:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .package-card h3 {
      color: var(--primary);
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .package-price {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 1rem;
    }

    .package-features {
      list-style: none;
      padding: 0;
      margin: 1rem 0;
    }

    .package-features li {
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .package-features li:before {
      content: "\2713";
      color: var(--accent);
      font-weight: bold;
      margin-right: 0.5rem;
    }

    .package-note {
      font-style: italic;
      color: var(--text-muted);
      font-size: 0.9rem;
      margin: 1rem 0;
    }

    .service-select-btn {
      background: var(--primary-dark);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius);
      font-weight: 500;
      cursor: pointer;
      width: 100%;
      transition: var(--transition);
    }

    .service-select-btn:hover {
      background: var(--accent-dark);
      transform: translateY(-2px);
    }

    /* Step Navigation */
    .step-nav {
      text-align: center;
      margin: 2rem 0;
    }

    .step-nav button {
      margin: 0 0.5rem;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      transition: var(--transition);
      font-weight: 500;
    }

    .step-nav button[type="button"] {
      background: var(--surface-light);
      color: var(--text);
      border: 1px solid var(--primary);
    }

    .step-nav button[type="submit"] {
      background: var(--primary-dark);
      color: white;
    }

    .step-nav button:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    /* Selected Service Display */
    #selectedServiceDisplay {
      margin-bottom: 1rem;
      padding: 1rem;
      background: var(--surface);
      border-radius: var(--radius);
      border-left: 4px solid var(--accent);
      color: var(--text);
    }

    #changeServiceBtn {
      background: var(--surface-light);
      color: var(--primary);
      border: 1px solid var(--primary);
      padding: 0.5rem 1rem;
      border-radius: var(--radius);
      cursor: pointer;
      font-size: 0.9rem;
      margin-left: 1rem;
      transition: var(--transition);
    }

    #changeServiceBtn:hover {
      background: var(--primary);
      color: white;
    }

    /* Form Fieldsets */
    fieldset {
      background: var(--surface);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--radius);
      padding: 2rem;
      margin: 2rem 0;
    }

    legend {
      background: var(--primary-dark);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: var(--radius);
      font-weight: 600;
    }

    label {
      display: block;
      margin-bottom: 1rem;
      color: var(--text);
      font-weight: 500;
    }

    input[type="number"],
    input[type="text"],
    input[type="tel"],
    select,
    textarea {
      background: var(--surface-light);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--radius);
      padding: 0.75rem;
      color: var(--text);
      margin-left: 0.5rem;
    }

    input[type="number"] { width: 100px; }
    input[type="text"],
    input[type="tel"] { width: 100%; max-width: 400px; }
    select { min-width: 200px; }
    textarea { width: 100%; resize: vertical; }

    input:focus, select:focus, textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.3);
      outline: none;
    }

    /* Checkbox and Radio labels on same line */
    .checkbox-label, .radio-label {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      margin-right: 1.5rem;
      margin-bottom: 0.5rem;
      cursor: pointer;
    }

    .checkbox-label input[type="checkbox"],
    .radio-label input[type="radio"] {
      width: auto;
      margin: 0;
    }

    /* Cable Run Rows with Info Buttons */
    .cable-run-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .cable-run-row label {
      flex: 1;
      margin-bottom: 0;
    }

    .info-btn {
      background: transparent;
      border: none;
      color: var(--primary);
      cursor: pointer;
      font-size: 1.2rem;
      padding: 0.25rem;
      transition: var(--transition);
      flex-shrink: 0;
    }

    .info-btn:hover {
      color: var(--accent);
      transform: scale(1.15);
    }

    .cable-info {
      display: none;
      background: var(--surface-light);
      border-left: 3px solid var(--accent);
      border-radius: var(--radius);
      padding: 0.75rem 1rem;
      margin: 0 0 1rem 0;
      font-size: 0.9rem;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .cable-info.active {
      display: block;
    }

    /* Toggle Groups */
    .toggle-group {
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .toggle-group:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    /* Brand Groups */
    .brand-group {
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .brand-group:last-child {
      border-bottom: none;
    }

    /* Equipment toggle */
    .equipment-toggle {
      margin: 1.5rem 0;
      padding: 1rem;
      background: var(--surface);
      border-radius: var(--radius);
    }

    /* Pricing Section */
    #pricingSection, #wholeHomePricingSection {
      background: var(--surface-light);
      border: 2px solid var(--accent);
    }

    #pricingSection p, #wholeHomePricingSection p {
      font-size: 1.1rem;
      margin: 0.5rem 0;
    }

    #pricingSection p strong, #wholeHomePricingSection p strong {
      color: var(--accent);
    }

    /* Liability Section */
    .liability-fieldset {
      border-color: var(--accent);
    }

    .liability-text {
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: var(--radius);
      font-size: 0.95rem;
      line-height: 1.6;
    }

    .liability-text ul {
      margin: 0.5rem 0 0 1.5rem;
      padding: 0;
    }

    .liability-text li {
      margin-bottom: 0.5rem;
    }

    .liability-checkbox {
      font-weight: 600;
      color: var(--accent);
      padding: 1rem;
      background: var(--surface-light);
      border-radius: var(--radius);
      border: 1px solid var(--accent);
    }

    /* Final Quote Summary */
    #finalQuoteSummary {
      background: var(--surface);
      border: 2px solid var(--primary);
      border-radius: var(--radius);
      padding: 2rem;
      margin: 2rem 0;
    }

    #finalQuoteSummary h3 {
      color: var(--primary);
      margin-bottom: 1.5rem;
      text-align: center;
      font-size: 1.5rem;
    }

    #finalQuoteSummary h4 {
      color: var(--accent);
      margin: 1.5rem 0 0.75rem;
      font-size: 1.1rem;
      font-weight: 600;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .summary-items {
      margin-bottom: 1rem;
    }

    .summary-line {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.4rem 0;
      font-size: 0.95rem;
    }

    .summary-line span:first-child {
      color: var(--text);
    }

    .summary-line span:last-child {
      color: var(--accent);
      font-weight: 500;
    }

    .summary-total {
      margin-top: 1rem;
      padding: 1rem;
      background: var(--surface-light);
      border-radius: var(--radius);
      border: 2px solid var(--accent);
    }

    .summary-total .summary-line {
      font-size: 1.2rem;
      font-weight: 700;
    }

    .summary-total .summary-line span:last-child {
      font-size: 1.4rem;
    }

    .summary-deposit {
      margin-top: 0.5rem;
      padding: 0.75rem 1rem;
      background: var(--surface-light);
      border-radius: var(--radius);
    }

    .summary-note {
      margin-top: 1rem;
      text-align: center;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    /* Contact Form */
    #quoteForm fieldset {
      background: var(--surface);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    #quoteForm input[type="text"],
    #quoteForm input[type="email"],
    #quoteForm input[type="tel"] {
      width: 100%;
      max-width: 100%;
    }

    /* Status Messages */
    #quoteStatus {
      text-align: center;
      margin-top: 1rem;
      padding: 1rem;
      border-radius: var(--radius);
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .package-cards {
        grid-template-columns: 1fr;
      }

      .step-nav button {
        margin: 0.25rem;
        width: 100%;
        max-width: 200px;
      }

      #finalQuoteSummary {
        padding: 1.5rem;
        margin: 1rem 0;
      }

      .checkbox-label, .radio-label {
        display: flex;
        margin-right: 0;
      }
    }
  </style>

  <script>
    // Media panel location toggle
    document.addEventListener('DOMContentLoaded', () => {
      const mediaPanelYes = document.getElementById('hasMediaPanelYes');
      const mediaPanelNo = document.getElementById('hasMediaPanelNo');
      const locationLabel = document.getElementById('mediaPanelLocationLabel');

      if (mediaPanelYes) {
        mediaPanelYes.addEventListener('change', () => {
          if (locationLabel) locationLabel.style.display = 'block';
        });
      }
      if (mediaPanelNo) {
        mediaPanelNo.addEventListener('change', () => {
          if (locationLabel) locationLabel.style.display = 'none';
        });
      }
    });
  </script>
  <script src="/scripts/quotes.js"></script>
  <%- include('partials/footer') %>
